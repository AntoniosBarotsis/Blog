<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>BudgetFixture | My Blog</title>
<meta name=keywords content="Java,Testing,Reflection">
<meta name=description content="A Proof of Concept AutoFixture Clone in java">
<meta name=author content="Antonios Barotsis">
<link rel=canonical href=https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/>
<link crossorigin=anonymous href=/Blog/assets/css/stylesheet.min.59067c5d74184c7b3fcf83bf4c654c92e1d67005c1054ed4e55e054c277110e3.css integrity="sha256-WQZ8XXQYTHs/z4O/TGVMkuHWcAXBBU7U5V4FTCdxEOM=" rel="preload stylesheet" as=style>
<link rel=icon href=https://antoniosbarotsis.github.io/Blog/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://antoniosbarotsis.github.io/Blog/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://antoniosbarotsis.github.io/Blog/favicon-32x32.png>
<link rel=apple-touch-icon href=https://antoniosbarotsis.github.io/Blog/apple-touch-icon.png>
<link rel=mask-icon href=https://antoniosbarotsis.github.io/Blog/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.87.0">
<meta property="og:title" content="BudgetFixture">
<meta property="og:description" content="A Proof of Concept AutoFixture Clone in java">
<meta property="og:type" content="article">
<meta property="og:url" content="https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/">
<meta property="og:image" content="https://antoniosbarotsis.github.io/Blog/images/logo.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-07-12T22:11:09+02:00">
<meta property="article:modified_time" content="2022-07-12T22:11:09+02:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://antoniosbarotsis.github.io/Blog/images/logo.png">
<meta name=twitter:title content="BudgetFixture">
<meta name=twitter:description content="A Proof of Concept AutoFixture Clone in java">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://antoniosbarotsis.github.io/Blog/posts/"},{"@type":"ListItem","position":2,"name":"BudgetFixture","item":"https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"BudgetFixture","name":"BudgetFixture","description":"A Proof of Concept AutoFixture Clone in java","keywords":["Java","Testing","Reflection"],"articleBody":"BudgetFixture BudgetFixture is a very minimal (budget one could say), proof of concept - clone of the AutoFixture package in Java.\nMy repository can be found here.\nWhat is AutoFixture AutoFixture is a very handy .NET library that is\n “designed to minimize the ‘Arrange’ phase of your unit tests in order to maximize maintainability. Its primary goal is to allow developers to focus on what is being tested rather than how to setup the test scenario, by making it easier to create object graphs containing test data.”\n What does that mean? In essence, it provides a neat interface for creating class instances for your tests with random data.\nIn their README they provide the following example:\n[Fact] public void IntroductoryTest() { // Arrange  Fixture fixture = new Fixture(); int expectedNumber = fixture.Createint(); MyClass sut = fixture.Create(); // Act  int result = sut.Echo(expectedNumber); // Assert  Assert.Equal(expectedNumber, result); } For comparison, this is what I ended up with:\npublic class Main { public static void main(String[] args) { Fixture.registerGenerators(); var test = Fixture.Generate(Person.class); System.out.println(test); // Person[id=fe4c38b1-aefc-4f6d-a60c-ca4918a3ad79, name=Random string]  } } Although these two admittedly look deceivingly similar, I regret to remind you that I dropped the project at a very early “proof of concept” stage, meaning that it is very much lacking a lot of features and configuration options, some of which would cause certain issues in your tests.\nThis project was more about seeing if something similar to this was even possible rather than creating a useful library I’m afraid.\nThat said, there’s some interesting bit of reflection involved which not too many people care enough about so you might still find it interesting!\nHow Did This Start? A friend of mine recently started working on his own Fuzzer which can be found here, go give it a star!\nThe idea is simple: Create certain blueprint classes (he called them Reference classes) which\nFor example, the following method would generate and print 100 random URIs;\nprivate static String getDemoUris(int seed) { URIReference symbol = new URIReference(); StringBuilder sb = new StringBuilder(); Random rnd = new Random(seed); for (int i = 0; i  100; i++) { sb.append(i).append(\": \"); symbol.generate(sb, rnd); sb.append(\"\\n\"); } return sb.toString(); } Me being me, I started thinking about how this would work in the context of a library.\nHaving used Jqwik in the past, I liked their idea of defining Providers which were functions that would leverage the library and generate random output with potential useful constraints.\nFor instance, here’s an example they include in their docs;\n@Provide ArbitraryInteger divisibleBy3() { return Arbitraries .integers() // an arbitrary integer  .between(1, 100) // between 1 and 100  .filter(i - i % 3 == 0); // that is also divisible by 3 } This deviates a bit from what I wanted to do but at the same time, it’s not like I had a very clear image of what I wanted to achieve in the first place.\nWhat Did I Want To Build? In my case, it would make more sense to have a let’s say intProvider or a UriProvider instead of a intThatIsDivisibleBy3, although it would be nice to allow the tester to override an intProvider with a intThatIsDivisibleBy3 in a specific test because why not, which is ironic for me to say considering the aforementioned feature is left as an exercise to the reader.\nI instead decided to go for simple data type providers and use those to build up any complex type. In the Person example from the beginning of the post, for example, I defined UUID and String providers (or generators as I ended up calling them) in separate files and used those behind the scenes to create a Person instance.\nMy idea was to worry about how this could look as a library rather than how the generation itself would work which is why as you will see I didn’t really add any features around it.\nEnd Result? I’m pretty happy with how this ended up looking. Most of this is taken from my repo’s README.\nFor this example, let’s create a Person record which we’ll try to generate automatically later:\n// Person.java public record Person(UUID id, String name) {} This class has 2 different classes in its fields, namely a UUID and a String so let’s create Generators for both of them:\n// UuidGenerator.java public class UuidGenerator extends GeneratorUUID { @Override public UUID call() { return UUID.randomUUID(); } } // StringGenerator.java public class StringGenerator extends GeneratorString { @Override public String call() { return \"Random string\"; } } The contents themselves are not important for the sake of the example, hence the \"Random String\".\nHeading back to our Main method, running the following piece of code\n// Main.java public class Main { public static void main(String[] args) { // register UuidGenerator.java \u0026 StringGenerator.java  Fixture.registerGenerators(); // Generate a Person instance  var test = Fixture.Generate(Person.class); // Check the results  System.out.println(test); } } Would print something like this:\nPerson[id=fe4c38b1-aefc-4f6d-a60c-ca4918a3ad79, name=Random string] I mentioned my friend’s Fuzzer earlier as, if that was also a library, we could use the Reference classes provided by it for our generators to very easily produce complex and randomised attributes for our tests.\nThe Plan Reiterating the previous paragraph but more concretely this time;\nThe plan is to fulfill the following:\n easily define a generator for a given data type register generators manually (and potentially override default) have a way to “discover” the generators automatically without the tester needing to manually write them out one by one have a very simple way of generating new classes  Getting Started with the Generator  Why does Java have Type Erasure? :(\n This right here was the main reason why I wanted to give this project a shot again. Java implements Type Erasure.\nHaving picked up reflection and Metaprogramming in general from C#, this was weird to me initially. Well, turns out that Java doesn’t like reflection as much as C# does and this is terribly apparent in any framework/library comparison between the 2 languages.\nBut I’m getting sidetracked here. Type erasure is a pretty big problem for this project. To fully understand why I’ll explain how I would be implementing this in a language that does not use type erasure (say C#). I’ll be using pseudo-ish code so don’t take it char by char for this example.\nIt would be possible to have a map (or dictionary depending on your language) of type , Callable where we are essentially mapping a class to some function that generates an instance of that class. Sounds simple enough right? Well since that T would get erased at runtime, we’d have no way of using our map as it would essentially get turned into . This would make many things easier (and safer) but since it’s not available we’ll go with the next best thing: using the class' string representation as the Key.\nSince we got that explanation out of the way, let’s see how we could create our Generator class then\n// Generator.java public abstract class GeneratorT { public abstract T call(); } Pretty simple so far, we have a class of some generic type T that also has a method call that returns something of that type T. I wanted both the class itself and the call method to be abstract so that concrete generators inherit from a class which will be important later when we try to detect them.\nComing back to the example from earlier, if we wanted a StringGenerator then that would be a Generator type and call would return a String.\nUnfortunately, with Java being Java, getting that T is somewhat cumbersome so we’ll add a method to help us with that here\npublic abstract class GeneratorT { public abstract T call(); final ClassT getType() { // Cast result to a generic class  ParameterizedType superclass = (ParameterizedType) getClass().getGenericSuperclass(); // Return first generic type (T)  return (ClassT) superclass.getActualTypeArguments()[0]; } } Calling this getType method on our StringGenerator would return java.lang.String.\nNotice that call is declared public so that it can be overriden by the tester while getType is both final (so it can’t be overriden) and also package-private.\nTo recap, we somewhat found a way around Java’s type erasure using the text representation of the classes instead of the classes themselves and we also made a wrapper abstract class to use for this. Now, all we have to do is literally everything else!\nCreating the Fixture Class Second step into the project and here comes the first decision I later regretted: turning this class into a Singleton.\nTest runners nowadays (JUnit included) play around with state scope a lot when running your tests. Your tests might be ran in parallel, certain objects involved in your tests might get an instance assigned to them for one single test or a group of tests, and so on. All these are usually fine if you are dealing with non-static classes. The pitfall of using static classes is that any change in the underlying configuration options that you provide might produce unexpected behavior if it takes place halfway through your test execution.\nYou will see later as I dive through my code that I have a ConstructorFinder interface, this is using the strategy pattern to abstract away how I choose a class constructor (I could either pick the one with the most attributes or the default one for example). I made this because, depending on your use case, you might want to configure your class attributes through the constructor instead of the setters or the other way around and I wanted the tester to be able to choose. This would be fine if you could choose this option in an individual Fixture instance instead of a singleton. You should generally try to avoid anything static in your tests and this is exactly why.\nAs an example, say that all of the entities you use in your tests have full arg constructors which you want to use when instantiating them, except for this one class which for some reason uses a no-arg constructor only for which you need to use the setters for. Were you to tell my fixture class “Hey, I want to use the no-arg constructor for this test” the class would do that and also use that behavior for all the remaining tests which is more than likely, undesirable.\nDon’t get me wrong, using a singleton somewhere is a good idea for this unless you want every new Fixture instance to rescan half your package hierarchy. What I should have done instead however is have the Singleton be some sort of configuration/builder object that would create the actual Fixture instance which would not be a singleton. This way, the state would not be shared between tests and that would not cause issues.\nWith that out of the way, let’s see what my Fixture class looks like.\npublic class Fixture { private static final ConstructorFinder constructorFinder = new LongestConstructorStrategy(); private static final HashMapString, Generator map = new HashMap(); private Fixture() { } private static HashMapString, Generator getMap() { return map; } } Nothing weird going on with the map as I explained my reasoning earlier. Let’s go on a small tangent and check the ConstructorFinder class before moving further down\n// ConstructorFinder.java public interface ConstructorFinderT { ConstructorT getConstructor(ClassT obj) throws NoSuchMethodException; } Similar to the Generator class from earlier, the idea is to, given a class T, return a constructor with generic type T which means a constructor that creates an instance of T.\nAs I mentioned earlier, I made 2 implementations of this interface as seen below:\n// DefaultConstructorStrategy.java public class DefaultConstructorStrategyT implements ConstructorFinderT{ @Override public ConstructorT getConstructor(ClassT obj) throws NoSuchMethodException { return obj.getConstructor(); } } // LongestConstructorStrategy.java public class LongestConstructorStrategyT implements ConstructorFinderT { @Override public ConstructorT getConstructor(ClassT obj) { // Get class constroctors  var ctors = obj.getConstructors(); // Find the one with the most parameters  var tmp = Arrays.stream(ctors) .max(Comparator.comparingInt(x - x.getParameterTypes().length)); // tmp is an optional so we need .get()  return (ConstructorT) tmp.get(); } } These definitely look safe and don’t have half a dozen things that could go wrong in a more realistic code base so let’s move on!\nSmall note here, currently the map allows overrides; if a specific Generator exists and is registered at runtime, nothing is preventing you from specifying another Generator for the same type, effectively overriding the previous one. This isn’t necessarily bad as you may want to make that override for a particular test (assuming again, the concerns I listed earlier about singletons are taken care of) which would look like this;\n// Using a Generator we have already // declared in a separate file Fixture.Register(new UuidGenerator()); // Or declaring one inline Fixture.Register(new GeneratorString() { @Override public String call() { return \"very cool random text\"; } }); And another small note, I have moved some of these methods to a helper class Util to declutter the original one, I’ll be adding the filename at the top to avoid confusion!\nI’ve also defined a Tuple class which looks like this:\n// Tuple.java public record TupleT, K(T _1, K _2) {} Dealing with the Generators As I mentioned earlier, I wanted a way to dynamically find all the declared generators and use them without the user needing to specify them.\nTo do that we first need to get all classes in the relevant package. I decided to consider the “relevant package” to be the package that calls the registerGenerators (which is the method that we are building up to). A nice addition here would be to include a configuration option (or a function overload) that allows the tester to specify the package where the generators are defined to save up some time on startup and to allow them to specify a different package.\nAnyway, this is the method I ended up with\n// Util.java private static ListTupleString, String listAllClassesFromPackage(String packageName) { // Get resource stream for given package  InputStream stream = ClassLoader .getSystemClassLoader() .getResourceAsStream(packageName); // If stream is null - return empty list  if (stream == null) { return List.of(); } // Turn stream into a list  BufferedReader reader = new BufferedReader(new InputStreamReader(stream)); var list = reader.lines().toList(); // Resulting list will be a list of  // tuples  var res = new LinkedListTupleString, String(); for (String s : list) { // If s is a class  if (s.endsWith(\".class\")) { // Add to res  res.add(new Tuple(s, packageName)); } // Recursively add nested package  res.addAll(listAllClassesFromPackage(packageName + \"/\" + s)); } return res; } We first need to get the resource stream of the passed package which might be null if there’s nothing left, in which case we return an empty list. If not, we turn that into a list and iterate through it. Classes do end in .class so we can easily filter those out and add them to the result list (res) along with the full package name so far. If the current element is not a class (and is, therefore, a package) we recursively call the same method again only with an updated package name. Finally, we return the list.\nBut where does this packageName initially come from? The following method retrieves it\n// Fixture.java private static String getPackageName() throws ClassNotFoundException { // Get stacktrace  StackTraceElement[] stacktrace = Thread.currentThread().getStackTrace(); // This corresponds to the context that called this method  StackTraceElement e = stacktrace[3]; // Load class and get its package name  return ClassLoader .getSystemClassLoader() .loadClass(e.getClassName()) .getPackageName() .replaceAll(\"\\\\.\", \"/\"); } This is quite self-explanatory except for the stack trace stuff, what’s that all about? This was borrowed from this StackOverflow post. Instead of the 2, I am using 3 since this get’s called from inside another method which adds another entry to the stack.\nMoving back to the Util class, I also made a small wrapper method to get the class given the path to it which is the following;\n// Util.java private static Class getClass(String className, String packageName) { var newClassName = // package  packageName.replaceAll(\"/\", \".\") + \".\" + // className (without .class)  className.substring(0, className.lastIndexOf('.')); try { // Retrieve class using the class name  return Class.forName(newClassName); } catch (ClassNotFoundException e) { throw new RuntimeException(\"Class \" + newClassName + \" was not found\"); } } Nothing interesting happening here, just including it to avoid confusion later.\nFinally, we get to the more interesting stuff. Combining the previous methods together, we get the following:\n// Util.java static SetClass findAllGenerators(String packageName) { // Get all classes for the given package  // lines is a List  var lines = listAllClassesFromPackage(packageName); return lines.stream() // Sanity check - filter for classes  .filter(el - el._1().endsWith(\".class\")) // Map to actual classes  .map(el - Util.getClass(el._1(), el._2())) // Filter for  .filter(el - // Classes with the Generator as a superclass  el.getSuperclass() != null \u0026\u0026 el.getSuperclass().equals(Generator.class) \u0026\u0026 // Classes that are not a Main class  Util.isNotMain(el) ) .collect(Collectors.toSet()); } private static boolean isNotMain(Class el) { try { // These would have \"$[number]\" for some reason,  // remove those  var newName = el.getName().replaceAll(\"\\\\$\\\\d+\", \"\"); // Try to get main method, if there is no main method  // this throws an exception  el.getClassLoader().loadClass(newName).getMethod(\"main\", String[].class); // If this didn't crash then it is a main method  return false; } catch (NoSuchMethodException ignored) { // if the method doesn't exist then it's not main  return true; } catch (ClassNotFoundException e) { throw new RuntimeException(e); } } Using the list generated from the listAllClassesFromPackage, we have a sanity check filter for the classes followed by a map that uses the getClass method I just mentioned. Now that we have a stream of Classes we can check to see if they inherit from Generator. Now, for some reason I did not figure out, that would also include the Main class which is why I also make sure that the current class does not have the Main method.\nLet’s recap really quick because that is a lot to take in;\n we have a way of getting the package name of the file that called a specific method we made we also have a way to scan that package for all classes that inherit from the Generator class we created earlier  This means that we can now finally build the registerGenerators method!\nThis method had way too many exceptions to catch so let’s look at it without the try-catch blocks first;\n// Fixture.java public static void registerGenerators() { // Get all generator classes  var res = Util.findAllGenerators(getPackageName()); // Instantiate and register the new generator  res.forEach(el - { Register((Generator) el.getConstructor().newInstance()); }); } public static T void Register(GeneratorT callable) { // Put new generator in the map  getMap().put(callable.getType().getName(), callable); } Well that seems simple! We call findAllGenerators with the relevant package name and then for each class in the resulting list, we call the Register method you can see right after which just adds them to the Fixture HashMap.\nThe real method looks more like this\n// Fixture.java public static void registerGenerators() { try { var res = Util.findAllGenerators(getPackageName()); res.forEach(el - { try { // I know this is a mess, the actual code is here  Register((Generator) el.getConstructor().newInstance()); // cheers  } catch (NoSuchMethodException e) { throw new RuntimeException(\"No constructor was found for class \" + el.getName()); } catch (IllegalAccessException e) { try { throw new RuntimeException(\"Constructor \" + el.getConstructor() + \" is not public\"); } catch (NoSuchMethodException ignored) {} // already caught above  } catch (InstantiationException e) { throw new RuntimeException(\"The class \" + el.getName() + \" could not be instantiated\"); } catch (InvocationTargetException e) { throw new RuntimeException(e); } }); } catch (ClassNotFoundException e) { throw new RuntimeException(e); } } It is worth noting that you should probably break this logic and error-catching down as this is way too many try-catches for one method but oh well, not my problem, if it works, it works eh?\nGenerating Class Instances Now that we have a way to dynamically find the declared generators and add them to our  map, it is time we start generating some class instances.\nI’ll take this backward this time and show you the finished method before the parts that make it up because I want you to see how simple it actually was\n// Fixture.java public static T T Generate(ClassT obj) { try { // Get class constructor  var ctor = (ConstructorT) constructorFinder.getConstructor(obj); // Generate a new instance using our generators  T res = ctor.newInstance(getConstructorParams(ctor)); // Also use the setters to populate the attributes  useSetters(res); return res; } catch (Exception e) { throw new RuntimeException(e); } } That’s it! We want to get a constructor of the provided class (using our strategy from earlier), create a new instance using that constructor (this uses our generators behind the scenes) and finally (technically also optionally), use our generators on all relevant setters.\nTechnically speaking, if this was an actual library you would want to let the tester decide whether or not you should use either the constructor, the setters or both. Perhaps this decision should be connected to the constructor finder strategy as in, default constructor \u0026 setters or big constructor and no setters. In any case, that is beyond the scope of what I wanted to achieve so I didn’t do much with it.\nBut enough with that, let’s take a look at the getConstructorParams method;\nprivate static T Object[] getConstructorParams(ConstructorT ctor) { return Arrays.stream(ctor.getParameters()) // Get constructor params  .map(Parameter::getType) // Get param type  .map(Class::getName) // Get class name  .map(el - getMap().get(el).call()) // Call appropriate generator  .toArray(); } For this, we want to basically do the exact opposite of what the Register method from earlier does; get the type class names, retrieve and call their corresponding Generators from our map.\nWith all this done, we have now created our class instance! As I mentioned earlier, stopping here would be fine (especially if we assumed that an all-arg constructor is always present) but as I mentioned earlier, I wanted to fiddle around with setters as well so let’s now take a look at useSetters;\nprivate static T void useSetters(T res) { // Create Map var fieldTypes = Arrays.stream(res.getClass().getDeclaredFields()) .collect(Collectors.toMap(Field::getName, Field::getType)); // Get all setters  var setters = Arrays.stream(res.getClass().getDeclaredMethods()) .filter(el - el.getName().toLowerCase(Locale.ROOT).contains(\"set\")).toList(); // for each field  fieldTypes.forEach((fieldName, fieldType) - { // Find related setter if exists  var setter = setters.stream() .filter(el - el.getName().toLowerCase(Locale.ROOT).contains(fieldName)) .findFirst(); // If a setter was found  setter.ifPresent(el - { try { // Find generator for given field type  var generator = getMap().get(fieldType.getName()); // Pass generator output to setter  el.invoke(res, generator.call()); } catch (IllegalAccessException | InvocationTargetException e) { throw new RuntimeException(e); } }); }); } This first creates a map of all the class field names and types which we’ll use later. It then finds all methods that contain “set” in their method name (so hopefully all setters). Then for each field, we try to find a setter that contains the field name in its name and if we do find it we try and get a generator for the current field through our map. Finally, we invoke the setter with whatever the generator call gives us.\nClosing All in all, I’m glad I have this idea a shot again. I tried one or two more times in the past but got stuck somewhere and dropped the project in favor of something else (preferably not Java) so it was definitely refreshing paying this a visit again after getting some new ideas from here and there.\nThis definitely was one way of spending the last 2 afternoons.\nTill next time!\n","wordCount":"3897","inLanguage":"en","image":"https://antoniosbarotsis.github.io/Blog/images/logo.png","datePublished":"2022-07-12T22:11:09+02:00","dateModified":"2022-07-12T22:11:09+02:00","author":{"@type":"Person","name":"Antonios Barotsis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/"},"publisher":{"@type":"Organization","name":"My Blog","logo":{"@type":"ImageObject","url":"https://antoniosbarotsis.github.io/Blog/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://antoniosbarotsis.github.io/Blog/ accesskey=h title="My Blog (Alt + H)">My Blog</a>
<span class=logo-switches>
</span>
</div>
<ul id=menu>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://antoniosbarotsis.github.io/Blog/>Home</a>&nbsp;»&nbsp;<a href=https://antoniosbarotsis.github.io/Blog/posts/>Posts</a></div>
<h1 class=post-title>
BudgetFixture
</h1>
<div class=post-description>
A Proof of Concept AutoFixture Clone in java
</div>
<div class=post-meta>July 12, 2022&nbsp;·&nbsp;19 min&nbsp;·&nbsp;Antonios Barotsis&nbsp;|&nbsp;<a href="https://github.com/AntoniosBarotsis/Blog/tree/master/content
/
posts/BudgetFixture/index.md" rel="noopener noreferrer" target=_blank>Suggest Changes</a></div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo_huc82ad864514e640b218f833abaa12e6e_27498_360x0_resize_box_3.png 360w ,https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo_huc82ad864514e640b218f833abaa12e6e_27498_480x0_resize_box_3.png 480w ,https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo_huc82ad864514e640b218f833abaa12e6e_27498_720x0_resize_box_3.png 720w ,https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo_huc82ad864514e640b218f833abaa12e6e_27498_1080x0_resize_box_3.png 1080w ,https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo.png 1350w" sizes="(min-width: 768px) 720px, 100vw" src=https://antoniosbarotsis.github.io/Blog/posts/budgetfixture/images/logo.png alt>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<div class=details>Table of Contents</div>
</summary>
<div class=inner><ul>
<li>
<a href=#budgetfixture aria-label=BudgetFixture>BudgetFixture</a><ul>
<li>
<a href=#what-is-autofixture aria-label="What is AutoFixture">What is AutoFixture</a></li>
<li>
<a href=#how-did-this-start aria-label="How Did This Start?">How Did This Start?</a></li>
<li>
<a href=#what-did-i-want-to-build aria-label="What Did I Want To Build?">What Did I Want To Build?</a></li>
<li>
<a href=#end-result aria-label="End Result?">End Result?</a></li>
<li>
<a href=#the-plan aria-label="The Plan">The Plan</a></li>
<li>
<a href=#getting-started-with-the-generator aria-label="Getting Started with the Generator">Getting Started with the Generator</a></li>
<li>
<a href=#creating-the-fixture-class aria-label="Creating the Fixture Class">Creating the Fixture Class</a><ul>
<li>
<a href=#dealing-with-the-generators aria-label="Dealing with the Generators">Dealing with the Generators</a></li></ul>
</li>
<li>
<a href=#generating-class-instances aria-label="Generating Class Instances">Generating Class Instances</a></li>
<li>
<a href=#closing aria-label=Closing>Closing</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=budgetfixture>BudgetFixture<a hidden class=anchor aria-hidden=true href=#budgetfixture>#</a></h1>
<p>BudgetFixture is a very minimal (budget one could say), proof of concept - clone of the
<a href=https://github.com/AutoFixture/AutoFixture>AutoFixture</a> package in Java.</p>
<p>My repository can be found <a href=https://github.com/AntoniosBarotsis/BudgetFixture>here</a>.</p>
<h2 id=what-is-autofixture>What is AutoFixture<a hidden class=anchor aria-hidden=true href=#what-is-autofixture>#</a></h2>
<p>AutoFixture is a very handy .NET library that is</p>
<blockquote>
<p>&ldquo;designed to minimize the &lsquo;Arrange&rsquo; phase of your unit
tests in order to maximize maintainability. Its primary goal is to allow developers to focus on what
is being tested rather than how to setup the test scenario, by making it easier to create object
graphs containing test data.&rdquo;</p>
</blockquote>
<p>What does that mean? In essence, it provides a neat interface for creating class instances for your
tests with random data.</p>
<p>In their README they provide the following example:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=color:#a6e22e>[Fact]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> IntroductoryTest()
{
    <span style=color:#75715e>// Arrange
</span><span style=color:#75715e></span>    Fixture fixture = <span style=color:#66d9ef>new</span> Fixture();

    <span style=color:#66d9ef>int</span> expectedNumber = fixture.Create&lt;<span style=color:#66d9ef>int</span>&gt;();
    MyClass sut = fixture.Create&lt;MyClass&gt;();
    <span style=color:#75715e>// Act
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>int</span> result = sut.Echo(expectedNumber);
    <span style=color:#75715e>// Assert
</span><span style=color:#75715e></span>    Assert.Equal(expectedNumber, result);
}
</code></pre></div><p>For comparison, this is what I ended up with:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>registerGenerators</span><span style=color:#f92672>();</span>

        var test <span style=color:#f92672>=</span> Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>Generate</span><span style=color:#f92672>(</span>Person<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>

        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>test<span style=color:#f92672>);</span>
        <span style=color:#75715e>// Person[id=fe4c38b1-aefc-4f6d-a60c-ca4918a3ad79, name=Random string]
</span><span style=color:#75715e></span>    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Although these two admittedly look deceivingly similar, I regret to remind you that
I dropped the project at a very early &ldquo;proof of concept&rdquo; stage, meaning that it is
very much lacking a lot of features and configuration options, some of which would
cause certain issues in your tests.</p>
<p>This project was more about seeing if something similar to this was even possible
rather than creating a useful library I&rsquo;m afraid.</p>
<p>That said, there&rsquo;s some interesting bit of reflection involved which not too many
people care enough about so you might still find it interesting!</p>
<h2 id=how-did-this-start>How Did This Start?<a hidden class=anchor aria-hidden=true href=#how-did-this-start>#</a></h2>
<p>A friend of mine recently started working on his own <a href=https://en.wikipedia.org/wiki/Fuzzing>Fuzzer</a>
which can be found <a href=https://github.com/martinmladenov/fuzzer>here</a>, go give it a star!</p>
<p>The idea is simple: Create certain blueprint classes (he called them Reference classes)
which</p>
<p>For example, the following method would generate and print 100 random URIs;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getDemoUris</span><span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> seed<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    URIReference symbol <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> URIReference<span style=color:#f92672>();</span>

    StringBuilder sb <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> StringBuilder<span style=color:#f92672>();</span>
    Random rnd <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Random<span style=color:#f92672>(</span>seed<span style=color:#f92672>);</span>

    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span><span style=color:#66d9ef>int</span> i <span style=color:#f92672>=</span> 0<span style=color:#f92672>;</span> i <span style=color:#f92672>&lt;</span> 100<span style=color:#f92672>;</span> i<span style=color:#f92672>++)</span> <span style=color:#f92672>{</span>
        sb<span style=color:#f92672>.</span><span style=color:#a6e22e>append</span><span style=color:#f92672>(</span>i<span style=color:#f92672>).</span><span style=color:#a6e22e>append</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;: &#34;</span><span style=color:#f92672>);</span>
        symbol<span style=color:#f92672>.</span><span style=color:#a6e22e>generate</span><span style=color:#f92672>(</span>sb<span style=color:#f92672>,</span> rnd<span style=color:#f92672>);</span>
        sb<span style=color:#f92672>.</span><span style=color:#a6e22e>append</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\n&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>return</span> sb<span style=color:#f92672>.</span><span style=color:#a6e22e>toString</span><span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Me being me, I started thinking about how this would work in the context of a library.</p>
<p>Having used <a href=https://jqwik.net/>Jqwik</a> in the past, I liked their idea of defining
<code>Providers</code> which were functions that would leverage the library and generate
random output with potential useful constraints.</p>
<p>For instance, here&rsquo;s an example they include in their docs;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#a6e22e>@Provide</span>
Arbitrary<span style=color:#f92672>&lt;</span>Integer<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>divisibleBy3</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
  <span style=color:#66d9ef>return</span> Arbitraries
      <span style=color:#f92672>.</span><span style=color:#a6e22e>integers</span><span style=color:#f92672>()</span>               <span style=color:#75715e>// an arbitrary integer
</span><span style=color:#75715e></span>      <span style=color:#f92672>.</span><span style=color:#a6e22e>between</span><span style=color:#f92672>(</span>1<span style=color:#f92672>,</span> 100<span style=color:#f92672>)</span>          <span style=color:#75715e>// between 1 and 100
</span><span style=color:#75715e></span>      <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>i <span style=color:#f92672>-&gt;</span> i <span style=color:#f92672>%</span> 3 <span style=color:#f92672>==</span> 0<span style=color:#f92672>);</span> <span style=color:#75715e>// that is also divisible by 3
</span><span style=color:#75715e></span><span style=color:#f92672>}</span>
</code></pre></div><p>This deviates a bit from what I wanted to do but at the same time, it&rsquo;s not like
I had a very clear image of what I wanted to achieve in the first place.</p>
<h2 id=what-did-i-want-to-build>What Did I Want To Build?<a hidden class=anchor aria-hidden=true href=#what-did-i-want-to-build>#</a></h2>
<p>In my case, it would make more sense to have a let&rsquo;s say <code>intProvider</code>
or a <code>UriProvider</code> instead of a <code>intThatIsDivisibleBy3</code>, although it would be nice to
allow the tester to override an <code>intProvider</code> with a <code>intThatIsDivisibleBy3</code> in a specific
test because why not, which is ironic for me to say considering the aforementioned feature
is left as an exercise to the reader.</p>
<p>I instead decided to go for simple data type providers and use those to build up any complex
type. In the <code>Person</code> example from the beginning of the post, for example, I defined <code>UUID</code> and
<code>String</code> providers (or generators as I ended up calling them) in separate files and used those
behind the scenes to create a <code>Person</code> instance.</p>
<p>My idea was to worry about how this could look as a library rather than how the generation
itself would work which is why as you will see I didn&rsquo;t really add any features around it.</p>
<h2 id=end-result>End Result?<a hidden class=anchor aria-hidden=true href=#end-result>#</a></h2>
<p>I&rsquo;m pretty happy with how this ended up looking. Most of this is taken from my repo&rsquo;s
<a href=https://github.com/AntoniosBarotsis/BudgetFixture>README</a>.</p>
<p>For this example, let&rsquo;s create a <code>Person</code> record which we&rsquo;ll try to generate automatically
later:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Person.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> record <span style=color:#a6e22e>Person</span><span style=color:#f92672>(</span>UUID id<span style=color:#f92672>,</span> String name<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</code></pre></div><p>This class has 2 different classes in its fields, namely a <code>UUID</code> and a <code>String</code> so let&rsquo;s
create <code>Generator</code>s for both of them:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// UuidGenerator.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>UuidGenerator</span> <span style=color:#66d9ef>extends</span> Generator<span style=color:#f92672>&lt;</span>UUID<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> UUID <span style=color:#a6e22e>call</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> UUID<span style=color:#f92672>.</span><span style=color:#a6e22e>randomUUID</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e>// StringGenerator.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>StringGenerator</span> <span style=color:#66d9ef>extends</span> Generator<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>call</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;Random string&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>The contents themselves are not important for the sake of the example, hence the <code>"Random String"</code>.</p>
<p>Heading back to our <code>Main</code> method, running the following piece of code</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Main.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Main</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span><span style=color:#f92672>(</span>String<span style=color:#f92672>[]</span> args<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// register UuidGenerator.java &amp; StringGenerator.java
</span><span style=color:#75715e></span>        Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>registerGenerators</span><span style=color:#f92672>();</span>

        <span style=color:#75715e>// Generate a Person instance
</span><span style=color:#75715e></span>        var test <span style=color:#f92672>=</span> Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>Generate</span><span style=color:#f92672>(</span>Person<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>

        <span style=color:#75715e>// Check the results
</span><span style=color:#75715e></span>        System<span style=color:#f92672>.</span><span style=color:#a6e22e>out</span><span style=color:#f92672>.</span><span style=color:#a6e22e>println</span><span style=color:#f92672>(</span>test<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Would print something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>Person[id=fe4c38b1-aefc-4f6d-a60c-ca4918a3ad79, name=Random string]
</code></pre></div><p>I mentioned my <a href=https://github.com/martinmladenov/fuzzer>friend&rsquo;s Fuzzer</a> earlier as, if that was
also a library, we could use the <code>Reference</code> classes provided by it for our generators to very easily
produce complex and randomised attributes for our tests.</p>
<h2 id=the-plan>The Plan<a hidden class=anchor aria-hidden=true href=#the-plan>#</a></h2>
<p>Reiterating the previous paragraph but more concretely this time;</p>
<p>The plan is to fulfill the following:</p>
<ul>
<li>easily define a generator for a given data type</li>
<li>register generators manually (and potentially override default)</li>
<li>have a way to &ldquo;discover&rdquo; the generators automatically without the tester
needing to manually write them out one by one</li>
<li>have a very simple way of generating new classes</li>
</ul>
<h2 id=getting-started-with-the-generator>Getting Started with the Generator<a hidden class=anchor aria-hidden=true href=#getting-started-with-the-generator>#</a></h2>
<blockquote>
<p>Why does Java have Type Erasure? :(</p>
</blockquote>
<p>This right here was the main reason why I wanted to give this project a shot <em>again</em>.
Java implements <a href=https://docs.oracle.com/javase/tutorial/java/generics/erasure.html>Type Erasure</a>.</p>
<p>Having picked up reflection and Metaprogramming in general from C#, this was weird to me initially.
Well, turns out that Java doesn&rsquo;t like reflection as much as C# does <em>and this is terribly apparent in
any framework/library comparison between the 2 languages</em>.</p>
<p>But I&rsquo;m getting sidetracked here. Type erasure is a pretty big problem for this project. To fully
understand why I&rsquo;ll explain how I would be implementing this in a language that does not use
type erasure (say C#). I&rsquo;ll be using pseudo-ish code so don&rsquo;t take it char by char for this example.</p>
<p>It would be possible to have a map (or dictionary depending on your language) of type
<code>&lt;Class&lt;T>, Callable&lt;T>></code> where we are essentially mapping a class to some function that
generates an instance of that class. Sounds simple enough right? Well since that <code>T</code> would get
erased at runtime, we&rsquo;d have no way of using our map as it would essentially get turned into
<code>&lt;Class, Callable></code>. This would make many things easier (and safer) but since it&rsquo;s not available
we&rsquo;ll go with the next best thing: using the class' string representation as the Key.</p>
<p>Since we got that explanation out of the way, let&rsquo;s see how we could create our Generator class then</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Generator.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Generator</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>call</span><span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Pretty simple so far, we have a class of some generic type <code>T</code> that also has a method <code>call</code> that
returns something of that type <code>T</code>. I wanted both the class itself and the <code>call</code> method to be abstract
so that concrete generators inherit from a class which will be important later when we try to detect
them.</p>
<p>Coming back to the example from earlier, if we wanted a <code>StringGenerator</code> then that would be a
<code>Generator&lt;String></code> type and <code>call</code> would return a <code>String</code>.</p>
<p>Unfortunately, with Java being Java, getting that <code>T</code> is somewhat cumbersome so we&rsquo;ll add a
method to help us with that here</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Generator</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>abstract</span> T <span style=color:#a6e22e>call</span><span style=color:#f92672>();</span>

    <span style=color:#66d9ef>final</span> Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getType</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Cast result to a generic class
</span><span style=color:#75715e></span>        ParameterizedType superclass <span style=color:#f92672>=</span> 
          <span style=color:#f92672>(</span>ParameterizedType<span style=color:#f92672>)</span> getClass<span style=color:#f92672>().</span><span style=color:#a6e22e>getGenericSuperclass</span><span style=color:#f92672>();</span>

        <span style=color:#75715e>// Return first generic type (T)
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;)</span> superclass<span style=color:#f92672>.</span><span style=color:#a6e22e>getActualTypeArguments</span><span style=color:#f92672>()[</span>0<span style=color:#f92672>];</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Calling this <code>getType</code> method on our <code>StringGenerator</code> would return <code>java.lang.String</code>.</p>
<p>Notice that <code>call</code> is declared <code>public</code> so that it can be overriden by the tester while
<code>getType</code> is both <code>final</code> (so it can&rsquo;t be overriden) and also package-private.</p>
<p>To recap, we somewhat found a way around Java&rsquo;s type erasure using the text representation of the
classes instead of the classes themselves and we also made a wrapper abstract class to use for this.
Now, all we have to do is literally everything else!</p>
<h2 id=creating-the-fixture-class>Creating the Fixture Class<a hidden class=anchor aria-hidden=true href=#creating-the-fixture-class>#</a></h2>
<p>Second step into the project and here comes the first decision I later regretted: turning this class
into a Singleton.</p>
<p>Test runners nowadays (JUnit included) play around with state scope a lot when running your tests.
Your tests might be ran in parallel, certain objects involved in your tests might get an instance
assigned to them for one single test or a group of tests, and so on. All these are usually fine
if you are dealing with non-static classes. The pitfall of using static classes is that any
change in the underlying configuration options that you provide might produce unexpected
behavior if it takes place halfway through your test execution.</p>
<p>You will see later as I dive through my code that I have a <code>ConstructorFinder</code> interface, this is
using the strategy pattern to abstract away how I choose a class constructor (I could either pick
the one with the most attributes or the default one for example). I made this because, depending on
your use case, you might want to configure your class attributes through the constructor instead of the
setters or the other way around and I wanted the tester to be able to choose. This would be fine if
you could choose this option in an individual Fixture instance instead of a singleton. You should
generally try to avoid anything static in your tests and this is exactly why.</p>
<p>As an example, say that all of the entities you use in your tests have full arg constructors
which you want to use when instantiating them, except for this one class which for some reason
uses a no-arg constructor only for which you need to use the setters for. Were you to tell my
fixture class &ldquo;Hey, I want to use the no-arg constructor for this test&rdquo; the class would <em>do</em> that
and also use that behavior for all the remaining tests which is more than likely, undesirable.</p>
<p>Don&rsquo;t get me wrong, using a singleton somewhere is a good idea for this unless you want every
new Fixture instance to rescan half your package hierarchy. What I should have done instead however
is have the Singleton be some sort of configuration/builder object that would create the actual
Fixture instance which would not be a singleton. This way, the state would not be shared between tests
and that would not cause issues.</p>
<p>With that out of the way, let&rsquo;s see what my Fixture class looks like.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Fixture</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> ConstructorFinder constructorFinder <span style=color:#f92672>=</span> 
        <span style=color:#66d9ef>new</span> LongestConstructorStrategy<span style=color:#f92672>&lt;&gt;();</span>
        
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>final</span> HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Generator<span style=color:#f92672>&lt;?&gt;&gt;</span> map <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> HashMap<span style=color:#f92672>&lt;&gt;();</span>

    <span style=color:#66d9ef>private</span> <span style=color:#a6e22e>Fixture</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span> <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> HashMap<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> Generator<span style=color:#f92672>&lt;?&gt;&gt;</span> getMap<span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> map<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Nothing weird going on with the map as I explained my reasoning earlier. Let&rsquo;s go on a small tangent
and check the <code>ConstructorFinder</code> class before moving further down</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// ConstructorFinder.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>ConstructorFinder</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> obj<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> NoSuchMethodException<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Similar to the <code>Generator</code> class from earlier, the idea is to, given a class <code>T</code>, return a
constructor with generic type <code>T</code> which means a constructor that creates an instance of <code>T</code>.</p>
<p>As I mentioned earlier, I made 2 implementations of this interface as seen below:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// DefaultConstructorStrategy.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DefaultConstructorStrategy</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>implements</span> ConstructorFinder<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> obj<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> NoSuchMethodException <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> obj<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

<span style=color:#75715e>// LongestConstructorStrategy.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>LongestConstructorStrategy</span><span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>implements</span> ConstructorFinder<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> obj<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Get class constroctors
</span><span style=color:#75715e></span>        var ctors <span style=color:#f92672>=</span> obj<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructors</span><span style=color:#f92672>();</span>

        <span style=color:#75715e>// Find the one with the most parameters
</span><span style=color:#75715e></span>        var tmp <span style=color:#f92672>=</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>(</span>ctors<span style=color:#f92672>)</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>max</span><span style=color:#f92672>(</span>Comparator<span style=color:#f92672>.</span><span style=color:#a6e22e>comparingInt</span><span style=color:#f92672>(</span>x <span style=color:#f92672>-&gt;</span> x<span style=color:#f92672>.</span><span style=color:#a6e22e>getParameterTypes</span><span style=color:#f92672>().</span><span style=color:#a6e22e>length</span><span style=color:#f92672>));</span>

        <span style=color:#75715e>// tmp is an optional so we need .get()
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#f92672>(</span>Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;)</span> tmp<span style=color:#f92672>.</span><span style=color:#a6e22e>get</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>These definitely look safe and don&rsquo;t have half a dozen things that could go wrong in a more
realistic code base so let&rsquo;s move on!</p>
<p>Small note here, currently the map allows overrides; if a specific Generator exists and is registered
at runtime, nothing is preventing you from specifying another Generator for the same type, effectively
overriding the previous one. This isn&rsquo;t necessarily bad as you may want to make that override for a
particular test (assuming again, the concerns I listed earlier about singletons are taken care of)
which would look like this;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Using a Generator we have already
</span><span style=color:#75715e>// declared in a separate file
</span><span style=color:#75715e></span>Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>Register</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> UuidGenerator<span style=color:#f92672>());</span>

<span style=color:#75715e>// Or declaring one inline
</span><span style=color:#75715e></span>Fixture<span style=color:#f92672>.</span><span style=color:#a6e22e>Register</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Generator<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
    <span style=color:#a6e22e>@Override</span>
    <span style=color:#66d9ef>public</span> String <span style=color:#a6e22e>call</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;very cool random text&#34;</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>});</span>
</code></pre></div><p>And another small note, I have moved some of these methods to a helper class <code>Util</code> to declutter
the original one, I&rsquo;ll be adding the filename at the top to avoid confusion!</p>
<p>I&rsquo;ve also defined a <code>Tuple</code> class which looks like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Tuple.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> record Tuple<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>,</span> K<span style=color:#f92672>&gt;(</span>T _1<span style=color:#f92672>,</span> K _2<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>
</code></pre></div><h3 id=dealing-with-the-generators>Dealing with the Generators<a hidden class=anchor aria-hidden=true href=#dealing-with-the-generators>#</a></h3>
<p>As I mentioned earlier, I wanted a way to dynamically find all the declared generators and
use them without the user needing to specify them.</p>
<p>To do that we first need to get all classes in the relevant package. I decided to consider
the &ldquo;relevant package&rdquo; to be the package that calls the <code>registerGenerators</code> (which is the
method that we are building up to). A nice addition here would be to include a configuration
option (or a function overload) that allows the tester to specify the package where the generators
are defined to save up some time on startup and to allow them to specify a different package.</p>
<p>Anyway, this is the method I ended up with</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Util.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> List<span style=color:#f92672>&lt;</span>Tuple<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;&gt;</span> <span style=color:#a6e22e>listAllClassesFromPackage</span><span style=color:#f92672>(</span>String packageName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Get resource stream for given package
</span><span style=color:#75715e></span>    InputStream stream <span style=color:#f92672>=</span> ClassLoader
        <span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>()</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>getResourceAsStream</span><span style=color:#f92672>(</span>packageName<span style=color:#f92672>);</span>

    <span style=color:#75715e>// If stream is null -&gt; return empty list
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>stream <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span><span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> List<span style=color:#f92672>.</span><span style=color:#a6e22e>of</span><span style=color:#f92672>();</span>
    <span style=color:#f92672>}</span>

    <span style=color:#75715e>// Turn stream into a list
</span><span style=color:#75715e></span>    BufferedReader reader <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> BufferedReader<span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> InputStreamReader<span style=color:#f92672>(</span>stream<span style=color:#f92672>));</span>
    var list <span style=color:#f92672>=</span> reader<span style=color:#f92672>.</span><span style=color:#a6e22e>lines</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toList</span><span style=color:#f92672>();</span>

    <span style=color:#75715e>// Resulting list will be a list of
</span><span style=color:#75715e></span>    <span style=color:#75715e>// &lt;className, packageName&gt; tuples
</span><span style=color:#75715e></span>    var res <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> LinkedList<span style=color:#f92672>&lt;</span>Tuple<span style=color:#f92672>&lt;</span>String<span style=color:#f92672>,</span> String<span style=color:#f92672>&gt;&gt;();</span>

    <span style=color:#66d9ef>for</span> <span style=color:#f92672>(</span>String s <span style=color:#f92672>:</span> list<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// If s is a class
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>s<span style=color:#f92672>.</span><span style=color:#a6e22e>endsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;.class&#34;</span><span style=color:#f92672>))</span> <span style=color:#f92672>{</span>
            <span style=color:#75715e>// Add to res
</span><span style=color:#75715e></span>            res<span style=color:#f92672>.</span><span style=color:#a6e22e>add</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> Tuple<span style=color:#f92672>&lt;&gt;(</span>s<span style=color:#f92672>,</span> packageName<span style=color:#f92672>));</span>
        <span style=color:#f92672>}</span>

        <span style=color:#75715e>// Recursively add nested package
</span><span style=color:#75715e></span>        res<span style=color:#f92672>.</span><span style=color:#a6e22e>addAll</span><span style=color:#f92672>(</span>listAllClassesFromPackage<span style=color:#f92672>(</span>packageName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/&#34;</span> <span style=color:#f92672>+</span> s<span style=color:#f92672>));</span>
    <span style=color:#f92672>}</span>

    <span style=color:#66d9ef>return</span> res<span style=color:#f92672>;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>We first need to get the resource stream of the passed package which might be null if there&rsquo;s nothing
left, in which case we return an empty list. If not, we turn that into a list and iterate through it.
Classes do end in <code>.class</code> so we can easily filter those out and add them to the result list (res) along
with the full package name so far. If the current element is not a class (and is, therefore, a package)
we recursively call the same method again only with an updated package name. Finally, we return the list.</p>
<p>But where does this <code>packageName</code> initially come from? The following method retrieves it</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Fixture.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> String <span style=color:#a6e22e>getPackageName</span><span style=color:#f92672>()</span> <span style=color:#66d9ef>throws</span> ClassNotFoundException <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Get stacktrace
</span><span style=color:#75715e></span>    StackTraceElement<span style=color:#f92672>[]</span> stacktrace <span style=color:#f92672>=</span> Thread<span style=color:#f92672>.</span><span style=color:#a6e22e>currentThread</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getStackTrace</span><span style=color:#f92672>();</span>

    <span style=color:#75715e>// This corresponds to the context that called this method
</span><span style=color:#75715e></span>    StackTraceElement e <span style=color:#f92672>=</span> stacktrace<span style=color:#f92672>[</span>3<span style=color:#f92672>];</span>

    <span style=color:#75715e>// Load class and get its package name
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> ClassLoader
        <span style=color:#f92672>.</span><span style=color:#a6e22e>getSystemClassLoader</span><span style=color:#f92672>()</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>loadClass</span><span style=color:#f92672>(</span>e<span style=color:#f92672>.</span><span style=color:#a6e22e>getClassName</span><span style=color:#f92672>())</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>getPackageName</span><span style=color:#f92672>()</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>replaceAll</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\.&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This is quite self-explanatory except for the stack trace stuff, what&rsquo;s that all about? This was
<em>borrowed</em> from <a href=https://stackoverflow.com/a/4065546/12756474>this</a> StackOverflow post. Instead of
the <code>2</code>, I am using <code>3</code> since this get&rsquo;s called from inside another method which adds another
entry to the stack.</p>
<p>Moving back to the Util class, I also made a small wrapper method to get the class given the path to it
which is the following;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Util.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> Class<span style=color:#f92672>&lt;?&gt;</span> getClass<span style=color:#f92672>(</span>String className<span style=color:#f92672>,</span> String packageName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    var newClassName <span style=color:#f92672>=</span> 
        <span style=color:#75715e>// package
</span><span style=color:#75715e></span>        packageName<span style=color:#f92672>.</span><span style=color:#a6e22e>replaceAll</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;/&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;.&#34;</span><span style=color:#f92672>)</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;.&#34;</span> <span style=color:#f92672>+</span>
        <span style=color:#75715e>// className (without .class)
</span><span style=color:#75715e></span>        className<span style=color:#f92672>.</span><span style=color:#a6e22e>substring</span><span style=color:#f92672>(</span>0<span style=color:#f92672>,</span> className<span style=color:#f92672>.</span><span style=color:#a6e22e>lastIndexOf</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#39;.&#39;</span><span style=color:#f92672>));</span>

    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Retrieve class using the class name
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> Class<span style=color:#f92672>.</span><span style=color:#a6e22e>forName</span><span style=color:#f92672>(</span>newClassName<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ClassNotFoundException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Class &#34;</span> <span style=color:#f92672>+</span> newClassName <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; was not found&#34;</span><span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Nothing interesting happening here, just including it to avoid confusion later.</p>
<p>Finally, we get to the more interesting stuff. Combining the previous methods together,
we get the following:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Util.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>static</span> Set<span style=color:#f92672>&lt;</span>Class<span style=color:#f92672>&lt;?&gt;&gt;</span> findAllGenerators<span style=color:#f92672>(</span>String packageName<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Get all classes for the given package
</span><span style=color:#75715e></span>    <span style=color:#75715e>// lines is a List&lt;Tuple&lt;className, packageName&gt;&gt;
</span><span style=color:#75715e></span>    var lines <span style=color:#f92672>=</span> listAllClassesFromPackage<span style=color:#f92672>(</span>packageName<span style=color:#f92672>);</span>

    <span style=color:#66d9ef>return</span> lines<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
        <span style=color:#75715e>// Sanity check - filter for classes
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>_1</span><span style=color:#f92672>().</span><span style=color:#a6e22e>endsWith</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;.class&#34;</span><span style=color:#f92672>))</span>
        <span style=color:#75715e>// Map to actual classes
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> Util<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>(</span>el<span style=color:#f92672>.</span><span style=color:#a6e22e>_1</span><span style=color:#f92672>(),</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>_2</span><span style=color:#f92672>()))</span>
        <span style=color:#75715e>// Filter for
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span>
            <span style=color:#75715e>// Classes with the Generator as a superclass
</span><span style=color:#75715e></span>            el<span style=color:#f92672>.</span><span style=color:#a6e22e>getSuperclass</span><span style=color:#f92672>()</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>&amp;&amp;</span>
            el<span style=color:#f92672>.</span><span style=color:#a6e22e>getSuperclass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>equals</span><span style=color:#f92672>(</span>Generator<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span> <span style=color:#f92672>&amp;&amp;</span>
            <span style=color:#75715e>// Classes that are not a Main class
</span><span style=color:#75715e></span>            Util<span style=color:#f92672>.</span><span style=color:#a6e22e>isNotMain</span><span style=color:#f92672>(</span>el<span style=color:#f92672>)</span>
        <span style=color:#f92672>)</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toSet</span><span style=color:#f92672>());</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>boolean</span> <span style=color:#a6e22e>isNotMain</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;?&gt;</span> el<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// These would have &#34;$[number]&#34; for some reason,
</span><span style=color:#75715e></span>        <span style=color:#75715e>// remove those
</span><span style=color:#75715e></span>        var newName <span style=color:#f92672>=</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>replaceAll</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\\$\\d+&#34;</span><span style=color:#f92672>,</span> <span style=color:#e6db74>&#34;&#34;</span><span style=color:#f92672>);</span>
        <span style=color:#75715e>// Try to get main method, if there is no main method
</span><span style=color:#75715e></span>        <span style=color:#75715e>// this throws an exception
</span><span style=color:#75715e></span>        el<span style=color:#f92672>.</span><span style=color:#a6e22e>getClassLoader</span><span style=color:#f92672>().</span><span style=color:#a6e22e>loadClass</span><span style=color:#f92672>(</span>newName<span style=color:#f92672>).</span><span style=color:#a6e22e>getMethod</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;main&#34;</span><span style=color:#f92672>,</span> String<span style=color:#f92672>[].</span><span style=color:#a6e22e>class</span><span style=color:#f92672>);</span>
        <span style=color:#75715e>// If this didn&#39;t crash then it is a main method
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchMethodException ignored<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// if the method doesn&#39;t exist then it&#39;s not main
</span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ClassNotFoundException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Using the list generated from the <code>listAllClassesFromPackage</code>, we have a sanity check filter
for the classes followed by a map that uses the <code>getClass</code> method I just mentioned. Now that
we have a stream of Classes we can check to see if they inherit from <code>Generator</code>. Now, for some
reason I did not figure out, that would also include the Main class which is why I also make sure
that the current class does not have the <code>Main</code> method.</p>
<p>Let&rsquo;s recap really quick because that is a lot to take in;</p>
<ul>
<li>we have a way of getting the package name of the file that called a specific method we made</li>
<li>we also have a way to scan that package for all classes that inherit from the <code>Generator</code> class we
created earlier</li>
</ul>
<p>This means that we can now finally build the <code>registerGenerators</code> method!</p>
<p>This method had way too many exceptions to catch so let&rsquo;s look at it without the try-catch
blocks first;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Fixture.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>registerGenerators</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Get all generator classes
</span><span style=color:#75715e></span>    var res <span style=color:#f92672>=</span> Util<span style=color:#f92672>.</span><span style=color:#a6e22e>findAllGenerators</span><span style=color:#f92672>(</span>getPackageName<span style=color:#f92672>());</span>

    <span style=color:#75715e>// Instantiate and register the new generator
</span><span style=color:#75715e></span>    res<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
        Register<span style=color:#f92672>((</span>Generator<span style=color:#f92672>&lt;?&gt;)</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>().</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>());</span>
    <span style=color:#f92672>});</span>
<span style=color:#f92672>}</span>

<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>Register</span><span style=color:#f92672>(</span>Generator<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> callable<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Put new generator in the map
</span><span style=color:#75715e></span>    getMap<span style=color:#f92672>().</span><span style=color:#a6e22e>put</span><span style=color:#f92672>(</span>callable<span style=color:#f92672>.</span><span style=color:#a6e22e>getType</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>(),</span> callable<span style=color:#f92672>);</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>Well that seems simple! We call <code>findAllGenerators</code> with the relevant package name and then
for each class in the resulting list, we call the <code>Register</code> method you can see right after
which just adds them to the Fixture HashMap.</p>
<p>The real method looks more like this</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Fixture.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>registerGenerators</span><span style=color:#f92672>()</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
        var res <span style=color:#f92672>=</span> Util<span style=color:#f92672>.</span><span style=color:#a6e22e>findAllGenerators</span><span style=color:#f92672>(</span>getPackageName<span style=color:#f92672>());</span>
        res<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
                <span style=color:#75715e>// I know this is a mess, the actual code is here
</span><span style=color:#75715e></span>                Register<span style=color:#f92672>((</span>Generator<span style=color:#f92672>&lt;?&gt;)</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>().</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>());</span>
                <span style=color:#75715e>// cheers
</span><span style=color:#75715e></span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchMethodException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;No constructor was found for class &#34;</span> <span style=color:#f92672>+</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>
            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IllegalAccessException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
                    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;Constructor &#34;</span> <span style=color:#f92672>+</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; is not public&#34;</span><span style=color:#f92672>);</span>
                <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>NoSuchMethodException ignored<span style=color:#f92672>)</span> <span style=color:#f92672>{}</span>  <span style=color:#75715e>// already caught above
</span><span style=color:#75715e></span>            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InstantiationException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;The class &#34;</span> <span style=color:#f92672>+</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>()</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; could not be instantiated&#34;</span><span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>InvocationTargetException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>});</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>ClassNotFoundException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>It is worth noting that you should probably break this logic and error-catching down as this is
way too many try-catches for one method but oh well, not my problem, if it works, it works eh?</p>
<h2 id=generating-class-instances>Generating Class Instances<a hidden class=anchor aria-hidden=true href=#generating-class-instances>#</a></h2>
<p>Now that we have a way to dynamically find the declared generators and add them to our
<code>&lt;dataType, Generator></code> map, it is time we start generating some class instances.</p>
<p>I&rsquo;ll take this backward this time and show you the finished method before the parts that make it up
because I want you to see how simple it actually was</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#75715e>// Fixture.java
</span><span style=color:#75715e></span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> T <span style=color:#a6e22e>Generate</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> obj<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Get class constructor
</span><span style=color:#75715e></span>        var ctor <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;)</span> constructorFinder<span style=color:#f92672>.</span><span style=color:#a6e22e>getConstructor</span><span style=color:#f92672>(</span>obj<span style=color:#f92672>);</span>

        <span style=color:#75715e>// Generate a new instance using our generators
</span><span style=color:#75715e></span>        T res <span style=color:#f92672>=</span> ctor<span style=color:#f92672>.</span><span style=color:#a6e22e>newInstance</span><span style=color:#f92672>(</span>getConstructorParams<span style=color:#f92672>(</span>ctor<span style=color:#f92672>));</span>

        <span style=color:#75715e>// Also use the setters to populate the attributes 
</span><span style=color:#75715e></span>        useSetters<span style=color:#f92672>(</span>res<span style=color:#f92672>);</span>

        <span style=color:#66d9ef>return</span> res<span style=color:#f92672>;</span>
    <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>Exception e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>That&rsquo;s it! We want to get a constructor of the provided class (using our strategy from earlier),
create a new instance using that constructor (this uses our generators behind the scenes)
and finally (technically also optionally), use our generators on all relevant setters.</p>
<p>Technically speaking, if this was an actual library you would want to let the tester decide whether
or not you should use either the constructor, the setters or both. Perhaps this decision should be
connected to the constructor finder strategy as in, default constructor & setters or
big constructor and no setters. In any case, that is beyond the scope of what I wanted to achieve
so I didn&rsquo;t do much with it.</p>
<p>But enough with that, let&rsquo;s take a look at the <code>getConstructorParams</code> method;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> Object<span style=color:#f92672>[]</span> <span style=color:#a6e22e>getConstructorParams</span><span style=color:#f92672>(</span>Constructor<span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> ctor<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#66d9ef>return</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>(</span>ctor<span style=color:#f92672>.</span><span style=color:#a6e22e>getParameters</span><span style=color:#f92672>())</span> <span style=color:#75715e>// Get constructor params
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Parameter<span style=color:#f92672>::</span>getType<span style=color:#f92672>)</span>               <span style=color:#75715e>// Get param type
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>Class<span style=color:#f92672>::</span>getName<span style=color:#f92672>)</span>                   <span style=color:#75715e>// Get class name
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>map</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> getMap<span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>el<span style=color:#f92672>).</span><span style=color:#a6e22e>call</span><span style=color:#f92672>())</span>    <span style=color:#75715e>// Call appropriate generator
</span><span style=color:#75715e></span>        <span style=color:#f92672>.</span><span style=color:#a6e22e>toArray</span><span style=color:#f92672>();</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>For this, we want to basically do the exact opposite of what the <code>Register</code> method from
earlier does; get the type class names, retrieve and call their corresponding Generators from our
map.</p>
<p>With all this done, we have now created our class instance! As I mentioned earlier, stopping here
would be fine (especially if we assumed that an all-arg constructor is always present) but as I
mentioned earlier, I wanted to fiddle around with setters as well so let&rsquo;s now take a look at
<code>useSetters</code>;</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> <span style=color:#f92672>&lt;</span>T<span style=color:#f92672>&gt;</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>useSetters</span><span style=color:#f92672>(</span>T res<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
    <span style=color:#75715e>// Create Map&lt;fieldName, fieldType&gt;
</span><span style=color:#75715e></span>    var fieldTypes <span style=color:#f92672>=</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>(</span>res<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredFields</span><span style=color:#f92672>())</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>collect</span><span style=color:#f92672>(</span>Collectors<span style=color:#f92672>.</span><span style=color:#a6e22e>toMap</span><span style=color:#f92672>(</span>Field<span style=color:#f92672>::</span>getName<span style=color:#f92672>,</span> Field<span style=color:#f92672>::</span>getType<span style=color:#f92672>));</span>

    <span style=color:#75715e>// Get all setters
</span><span style=color:#75715e></span>    var setters <span style=color:#f92672>=</span> Arrays<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>(</span>res<span style=color:#f92672>.</span><span style=color:#a6e22e>getClass</span><span style=color:#f92672>().</span><span style=color:#a6e22e>getDeclaredMethods</span><span style=color:#f92672>())</span>
        <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toLowerCase</span><span style=color:#f92672>(</span>Locale<span style=color:#f92672>.</span><span style=color:#a6e22e>ROOT</span><span style=color:#f92672>).</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span><span style=color:#e6db74>&#34;set&#34;</span><span style=color:#f92672>)).</span><span style=color:#a6e22e>toList</span><span style=color:#f92672>();</span>

    <span style=color:#75715e>// for each field
</span><span style=color:#75715e></span>    fieldTypes<span style=color:#f92672>.</span><span style=color:#a6e22e>forEach</span><span style=color:#f92672>((</span>fieldName<span style=color:#f92672>,</span> fieldType<span style=color:#f92672>)</span> <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
        <span style=color:#75715e>// Find related setter if exists
</span><span style=color:#75715e></span>        var setter <span style=color:#f92672>=</span> setters<span style=color:#f92672>.</span><span style=color:#a6e22e>stream</span><span style=color:#f92672>()</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>filter</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> el<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>().</span><span style=color:#a6e22e>toLowerCase</span><span style=color:#f92672>(</span>Locale<span style=color:#f92672>.</span><span style=color:#a6e22e>ROOT</span><span style=color:#f92672>).</span><span style=color:#a6e22e>contains</span><span style=color:#f92672>(</span>fieldName<span style=color:#f92672>))</span>
            <span style=color:#f92672>.</span><span style=color:#a6e22e>findFirst</span><span style=color:#f92672>();</span>

        <span style=color:#75715e>// If a setter was found
</span><span style=color:#75715e></span>        setter<span style=color:#f92672>.</span><span style=color:#a6e22e>ifPresent</span><span style=color:#f92672>(</span>el <span style=color:#f92672>-&gt;</span> <span style=color:#f92672>{</span>
            <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
                <span style=color:#75715e>// Find generator for given field type
</span><span style=color:#75715e></span>                var generator <span style=color:#f92672>=</span> getMap<span style=color:#f92672>().</span><span style=color:#a6e22e>get</span><span style=color:#f92672>(</span>fieldType<span style=color:#f92672>.</span><span style=color:#a6e22e>getName</span><span style=color:#f92672>());</span>

                <span style=color:#75715e>// Pass generator output to setter
</span><span style=color:#75715e></span>                el<span style=color:#f92672>.</span><span style=color:#a6e22e>invoke</span><span style=color:#f92672>(</span>res<span style=color:#f92672>,</span> generator<span style=color:#f92672>.</span><span style=color:#a6e22e>call</span><span style=color:#f92672>());</span>
            <span style=color:#f92672>}</span> <span style=color:#66d9ef>catch</span> <span style=color:#f92672>(</span>IllegalAccessException <span style=color:#f92672>|</span> InvocationTargetException e<span style=color:#f92672>)</span> <span style=color:#f92672>{</span>
                <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> RuntimeException<span style=color:#f92672>(</span>e<span style=color:#f92672>);</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>});</span>
    <span style=color:#f92672>});</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>This first creates a map of all the class field names and types which we&rsquo;ll use later.
It then finds all methods that contain &ldquo;set&rdquo; in their method name (so hopefully all setters).
Then for each field, we try to find a setter that contains the field name in its name and if
we do find it we try and get a generator for the current field through our map. Finally, we
invoke the setter with whatever the generator call gives us.</p>
<h2 id=closing>Closing<a hidden class=anchor aria-hidden=true href=#closing>#</a></h2>
<p>All in all, I&rsquo;m glad I have this idea a shot again. I tried one or two more times in the past
but got stuck somewhere and dropped the project in favor of something else (preferably not Java)
so it was definitely refreshing paying this a visit again after getting some new ideas from here
and there.</p>
<p>This definitely was one way of spending the last 2 afternoons.</p>
<p>Till next time!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://antoniosbarotsis.github.io/Blog/tags/java/>Java</a></li>
<li><a href=https://antoniosbarotsis.github.io/Blog/tags/testing/>Testing</a></li>
<li><a href=https://antoniosbarotsis.github.io/Blog/tags/reflection/>Reflection</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://antoniosbarotsis.github.io/Blog/posts/simplejwt/>
<span class=title>Next Page »</span>
<br>
<span>Simple JWT</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on twitter" href="https://twitter.com/intent/tweet/?text=BudgetFixture&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f&hashtags=Java%2cTesting%2cReflection"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f&title=BudgetFixture&summary=BudgetFixture&source=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f&title=BudgetFixture"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on whatsapp" href="https://api.whatsapp.com/send?text=BudgetFixture%20-%20https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share BudgetFixture on telegram" href="https://telegram.me/share/url?text=BudgetFixture&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fbudgetfixture%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><script src=https://utteranc.es/client.js repo=AntoniosBarotsis/Blog issue-term=pathname label=Comment theme=github-dark crossorigin=anonymous async></script>
</article>
</main>
</body>
</html>