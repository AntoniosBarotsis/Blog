<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Simple JWT | My Blog</title>
<meta name=keywords content="Csharp">
<meta name=description content="A simple JWT authorization scheme">
<meta name=author content="Antonios Barotsis">
<link rel=canonical href=https://antoniosbarotsis.github.io/Blog/posts/simplejwt/>
<link crossorigin=anonymous href=/Blog/assets/css/stylesheet.min.59067c5d74184c7b3fcf83bf4c654c92e1d67005c1054ed4e55e054c277110e3.css integrity="sha256-WQZ8XXQYTHs/z4O/TGVMkuHWcAXBBU7U5V4FTCdxEOM=" rel="preload stylesheet" as=style>
<link rel=icon href=https://antoniosbarotsis.github.io/Blog/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://antoniosbarotsis.github.io/Blog/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://antoniosbarotsis.github.io/Blog/favicon-32x32.png>
<link rel=apple-touch-icon href=https://antoniosbarotsis.github.io/Blog/apple-touch-icon.png>
<link rel=mask-icon href=https://antoniosbarotsis.github.io/Blog/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.87.0">
<meta property="og:title" content="Simple JWT">
<meta property="og:description" content="A simple JWT authorization scheme">
<meta property="og:type" content="article">
<meta property="og:url" content="https://antoniosbarotsis.github.io/Blog/posts/simplejwt/">
<meta property="og:image" content="https://antoniosbarotsis.github.io/Blog/images/jwt.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-06-29T18:16:47+02:00">
<meta property="article:modified_time" content="2022-06-29T18:16:47+02:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://antoniosbarotsis.github.io/Blog/images/jwt.png">
<meta name=twitter:title content="Simple JWT">
<meta name=twitter:description content="A simple JWT authorization scheme">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://antoniosbarotsis.github.io/Blog/posts/"},{"@type":"ListItem","position":2,"name":"Simple JWT","item":"https://antoniosbarotsis.github.io/Blog/posts/simplejwt/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Simple JWT","name":"Simple JWT","description":"A simple JWT authorization scheme","keywords":["Csharp"],"articleBody":"Simple JWT Authorization with .NET Recently I have been working on a side project that needed a very simple toy-like auth scheme to be implemented. The last few times I implemented JWTs in .NET it was for a full-blown application which means that I made use of things like IdentityModel and UserManager, if you want a look at how I made that work you could take a look at the source code of Demeter.\nIn this case, I did not need Authentication, just Authorization. The two are defined as followed in the MS Docs.\n Authentication is the process of proving that you are who you say you are. […] Authorization is the act of granting an authenticated party permission to do something. It specifies what data you’re allowed to access and what you can do with that data.\n For my use case, simulating a credential check is enough; I don’t need to store and check password salted hashes to make sure a user is indeed who he is supposed to be as this is a toy app that I am working on with supposedly just one user. All this means that if you are looking for a tutorial on how to implement Auth for your new project, this is probably not the article for you, it is just a less verbose way of dealing with JWT generation and validation that works for me.\nThat being said, let’s get started.\nSetup The only package I used is JWT.Extensions. I created 3 classes that make everything work:\n JwtConfig: Holds the JWT secret which is provided in the application.json file. Could also be used for other pieces of configuration such as the token lifespan Secured: An attribute that when attached to a controller or a specific endpoint requires a valid token to be provided in the request header TokenService: A very simple interface to the JWT.Extensions API that helps us create and validate tokens.  The JwtConfig Let’s start with the config class first. The idea with this is pretty simple; have a section in our appsettings.json file where we define crucial security information in plain text, what could possibly go wrong! On a more serious note, while this is fine for developing, you should definitely use something like app secrets or plain old environment variables for this. Once again, my app is not supposed to be secure so I don’t care.\nThe class itself is pretty simple in my case:\npublic record JwtConfig(string Secret = \"fallback-secret\"); And here’s my settings file\n{ \"JwtConfig\": { \"secret\": \"jwt-secret\" }, \"Logging\": { ... }, ... } Now that that’s out of the way, let’s make sure we use the secret from our settings file in the JwtConfig instances.\nI made it so the class is registered as a singleton in the DI container, the binding itself is pretty simple:\n// Program.cs var jwtConfig = new JwtConfig(); builder.Configuration.Bind(nameof(jwtConfig), jwtConfig); builder.Services.AddSingleton(jwtConfig); I used nameof just because I wanted to be sure that the config file’s section is titled the exact same as the class itself to avoid confusion, this is just a string so swapping it out for \"JwtConfig\" would change nothing.\nSince we are here, let’s also configure some basic settings for our tokens\n// Program.cs builder.Services.AddAuthentication(options = { options.DefaultChallengeScheme = JwtAuthenticationDefaults.AuthenticationScheme; options.DefaultAuthenticateScheme = JwtAuthenticationDefaults.AuthenticationScheme; }) .AddJwt(options = { options.Keys = new[] { jwtConfig.Secret }; }); builder.Services.AddSingleton(new HMACSHAAlgorithmFactory()); This is taken straight from their documentation so I won’t be explaining it too much, just know that we are telling the package to use the key we just defined and we are also using the HMACSHA algorithm.\nIt is worth noting that this throws us a warning as this is no longer considered secure and it is recommended to “consider switching to RSASSA or ECDSA”. Once again, for the purposes of my use case, this is not a concern.\nThe TokenService This is where most of the interesting stuff happens. Let’s first create the class, get our jwtConfig secret and assign it to a JwtBuilder instance which we’ll use later.\npublic class TokenService { private readonly JwtBuilder _jwtBuilder; public TokenService(JwtConfig jwtConfig) { _jwtBuilder = JwtBuilder.Create() .WithAlgorithm(new HMACSHA512Algorithm()) .WithSecret(jwtConfig.Secret); } } Creating the token itself is also pretty much copy-pasted from their docs.\npublic string Create(string username) { return _jwtBuilder .AddClaim(\"exp\", DateTimeOffset.UtcNow.AddHours(1).ToUnixTimeSeconds()) .AddClaim(\"username\", username) .Encode(); } I only use the expiration date and username for claims.\nLastly, verification.\npublic bool Verify(string token) { try { var json = _jwtBuilder .MustVerifySignature() .Decode(token); return json is not null; } catch (Exception) { return false; } } I only need a true or false return as I don’t care why the token was not valid. In case the token is a valid JWT but it is expired, json will be null. If on the other hand, the signature is invalid, then an exception will be thrown for whatever reason.\nThe Secured Attribute As I mentioned earlier, all this is glued together by the use of attributes. For this to work, we need to implement the IAuthorizationFilter interface. This will make it so our code will be executed to determine whether a request should be authorized or not.\nThe code for this is also simple but let’s go over it step by step\n[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)] public class Secured : Attribute, IAuthorizationFilter { public void OnAuthorization(AuthorizationFilterContext context) { var jwtConfig = context.HttpContext.RequestServices.GetService(); if (jwtConfig == null) throw new ArgumentNullException(); var tokenService = new TokenService(jwtConfig); var token = context .HttpContext .Request .Headers[\"Authorization\"] .ToString() .Replace(\"Bearer \", \"\"); if (!tokenService.Verify(token)) context.Result = new JsonResult(new { message = \"Unauthorized\" }) { StatusCode = StatusCodes.Status401Unauthorized }; } } As I mentioned earlier, I want this to apply to both endpoints and entire controllers, hence the first line. In order to implement IAuthorizationFilter, we need to define the OnAuthorization method. We use the IServiceProdiver to retrieve our JwtConfig instance and make sure it is not null. We then instantiate TokenService and retrieve the token from the request header. Finally, we make sure to throw an Unauthorized message to the user if the token is invalid, otherwise, the request pipeline will proceed as expected.\nAnd that’s it! We can now add our newly created attribute to whichever controller or endpoint we want and it will be locked behind a valid JWT requirement.\nClosing This pretty much concludes the article! As I mentioned earlier, this is a very specific and lacking implementation, the main point of the article was to showcase how you could use your own attributes to simplify the process which to me feels simpler (and less verbose) compared to some of my previous implementations.\nThis is probably the most boring article I’ve written so far but I promise you that the project I am going to use this for is interesting. It’s also a lot harder than anything I’ve tried before so don’t expect that the be out anytime soon.\nTill next time :)\n","wordCount":"1146","inLanguage":"en","image":"https://antoniosbarotsis.github.io/Blog/images/jwt.png","datePublished":"2022-06-29T18:16:47+02:00","dateModified":"2022-06-29T18:16:47+02:00","author":{"@type":"Person","name":"Antonios Barotsis"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://antoniosbarotsis.github.io/Blog/posts/simplejwt/"},"publisher":{"@type":"Organization","name":"My Blog","logo":{"@type":"ImageObject","url":"https://antoniosbarotsis.github.io/Blog/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<noscript>
<style type=text/css>#theme-toggle,.top-link{display:none}</style>
</noscript>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://antoniosbarotsis.github.io/Blog/ accesskey=h title="My Blog (Alt + H)">My Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/search/ title="Search (Alt + /)" accesskey=/>
<span>Search</span>
</a>
</li>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/categories/ title=Categories>
<span>Categories</span>
</a>
</li>
<li>
<a href=https://antoniosbarotsis.github.io/Blog/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://antoniosbarotsis.github.io/Blog/>Home</a>&nbsp;»&nbsp;<a href=https://antoniosbarotsis.github.io/Blog/posts/>Posts</a></div>
<h1 class=post-title>
Simple JWT
</h1>
<div class=post-description>
A simple JWT authorization scheme
</div>
<div class=post-meta>June 29, 2022&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Antonios Barotsis&nbsp;|&nbsp;<a href="https://github.com/AntoniosBarotsis/Blog/tree/master/content
/
posts/SimpleJWT/index.md" rel="noopener noreferrer" target=_blank>Suggest Changes</a></div>
</header>
<figure class=entry-cover>
<img loading=lazy srcset="https://antoniosbarotsis.github.io/Blog/posts/simplejwt/images/jwt_hu0d313529d27aefc5d2a25bbd61fa64d6_11109_360x0_resize_box_3.png 360w ,https://antoniosbarotsis.github.io/Blog/posts/simplejwt/images/jwt_hu0d313529d27aefc5d2a25bbd61fa64d6_11109_480x0_resize_box_3.png 480w ,https://antoniosbarotsis.github.io/Blog/posts/simplejwt/images/jwt.png 700w" sizes="(min-width: 768px) 720px, 100vw" src=https://antoniosbarotsis.github.io/Blog/posts/simplejwt/images/jwt.png alt>
</figure><div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<div class=details>Table of Contents</div>
</summary>
<div class=inner><ul>
<li>
<a href=#simple-jwt-authorization-with-net aria-label="Simple JWT Authorization with .NET">Simple JWT Authorization with .NET</a><ul>
<li>
<a href=#setup aria-label=Setup>Setup</a></li>
<li>
<a href=#the-jwtconfig aria-label="The JwtConfig">The <code>JwtConfig</code></a></li>
<li>
<a href=#the-tokenservice aria-label="The TokenService">The <code>TokenService</code></a></li>
<li>
<a href=#the-secured-attribute aria-label="The Secured Attribute">The <code>Secured</code> Attribute</a></li>
<li>
<a href=#closing aria-label=Closing>Closing</a>
</li>
</ul>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h1 id=simple-jwt-authorization-with-net>Simple JWT Authorization with .NET<a hidden class=anchor aria-hidden=true href=#simple-jwt-authorization-with-net>#</a></h1>
<p>Recently I have been working on a side project that needed a very simple toy-like auth
scheme to be implemented. The last few times I implemented JWTs in .NET it was for a full-blown
application which means that I made use of things like <code>IdentityModel</code> and <code>UserManager</code>,
if you want a look at how I made that work you could take a look at the source code of
<a href=https://github.com/AntoniosBarotsis/Demeter>Demeter</a>.</p>
<p>In this case, I did not need <em>Authentication</em>, just <em>Authorization</em>. The two are defined as followed
in the <a href=https://docs.microsoft.com/en-us/azure/active-directory/develop/authentication-vs-authorization>MS Docs</a>.</p>
<blockquote>
<p>Authentication is the process of proving that you are who you say you are. [&mldr;]
Authorization is the act of granting an authenticated party permission to do something.
It specifies what data you&rsquo;re allowed to access and what you can do with that data.</p>
</blockquote>
<p>For my use case, simulating a credential check is enough; I don&rsquo;t need to store and check
password salted hashes to make sure a user is indeed who he is supposed to be as this is a toy app
that I am working on with supposedly just one user. All this means that if you are looking for a
tutorial on how to implement Auth for your new project, this is probably not the article for you,
it is just a less verbose way of dealing with JWT generation and validation that works for me.</p>
<p>That being said, let&rsquo;s get started.</p>
<h2 id=setup>Setup<a hidden class=anchor aria-hidden=true href=#setup>#</a></h2>
<p>The only package I used is <a href=https://www.nuget.org/packages/JWT.Extensions.AspNetCore>JWT.Extensions</a>.
I created 3 classes that make everything work:</p>
<ul>
<li><code>JwtConfig</code>: Holds the JWT secret which is provided in the <code>application.json</code> file. Could also be
used for other pieces of configuration such as the token lifespan</li>
<li><code>Secured</code>: An attribute that when attached to a controller or a specific endpoint requires a
valid token to be provided in the request header</li>
<li><code>TokenService</code>: A very simple interface to the <code>JWT.Extensions</code> API that helps us create and
validate tokens.</li>
</ul>
<h2 id=the-jwtconfig>The <code>JwtConfig</code><a hidden class=anchor aria-hidden=true href=#the-jwtconfig>#</a></h2>
<p>Let&rsquo;s start with the config class first. The idea with this is pretty simple; have a section in our
<code>appsettings.json</code> file where we define crucial security information in plain text, what could
possibly go wrong! On a more serious note, while this is fine for developing, you should definitely
use something like <a href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets?view=aspnetcore-6.0&tabs=windows">app secrets</a>
or plain old environment variables for this. Once again, my app is not supposed to be secure so I don&rsquo;t
care.</p>
<p>The class itself is pretty simple in my case:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> record JwtConfig(<span style=color:#66d9ef>string</span> Secret = <span style=color:#e6db74>&#34;fallback-secret&#34;</span>);
</code></pre></div><p>And here&rsquo;s my settings file</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;JwtConfig&#34;</span>: {
    <span style=color:#f92672>&#34;secret&#34;</span>: <span style=color:#e6db74>&#34;jwt-secret&#34;</span>
  },
  <span style=color:#f92672>&#34;Logging&#34;</span>: {
    <span style=color:#960050;background-color:#1e0010>...</span>
  },
  <span style=color:#960050;background-color:#1e0010>...</span>
}
</code></pre></div><p>Now that that&rsquo;s out of the way, let&rsquo;s make sure we use the secret from our settings file in the
<code>JwtConfig</code> instances.</p>
<p>I made it so the class is registered as a singleton in the DI container, the binding itself is
pretty simple:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// Program.cs
</span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> jwtConfig = <span style=color:#66d9ef>new</span> JwtConfig();
builder.Configuration.Bind(nameof(jwtConfig), jwtConfig);
builder.Services.AddSingleton(jwtConfig);
</code></pre></div><p>I used <code>nameof</code> just because I wanted to be sure that the config file&rsquo;s section is titled the
exact same as the class itself to avoid confusion, this is just a string so swapping it out for
<code>"JwtConfig"</code> would change nothing.</p>
<p>Since we are here, let&rsquo;s also configure some basic settings for our tokens</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#75715e>// Program.cs
</span><span style=color:#75715e></span>builder.Services.AddAuthentication(options =&gt;
    {
        options.DefaultChallengeScheme = JwtAuthenticationDefaults.AuthenticationScheme;
        options.DefaultAuthenticateScheme = JwtAuthenticationDefaults.AuthenticationScheme;
    })
    .AddJwt(options =&gt; { options.Keys = <span style=color:#66d9ef>new</span>[] { jwtConfig.Secret }; });

builder.Services.AddSingleton&lt;IAlgorithmFactory&gt;(<span style=color:#66d9ef>new</span> HMACSHAAlgorithmFactory());
</code></pre></div><p>This is taken straight from their <a href=https://github.com/jwt-dotnet/jwt#register-authentication-handler-to-validate-jwt>documentation</a>
so I won&rsquo;t be explaining it too much, just know that we are telling the package to use
the key we just defined and we are also using the <code>HMACSHA</code> algorithm.</p>
<p>It is worth noting that this throws us a warning as this is no longer considered secure
and it is recommended to &ldquo;consider switching to RSASSA or ECDSA&rdquo;. Once again, for the purposes
of my use case, this is not a concern.</p>
<h2 id=the-tokenservice>The <code>TokenService</code><a hidden class=anchor aria-hidden=true href=#the-tokenservice>#</a></h2>
<p>This is where most of the interesting stuff happens. Let&rsquo;s first create the class, get our
<code>jwtConfig</code> secret and assign it to a <code>JwtBuilder</code> instance which we&rsquo;ll use later.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>TokenService</span>
{
    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> JwtBuilder <span style=color:#ae81ff>_</span>jwtBuilder;

    <span style=color:#66d9ef>public</span> TokenService(JwtConfig jwtConfig)
    {
        <span style=color:#ae81ff>_</span>jwtBuilder = JwtBuilder.Create()
            .WithAlgorithm(<span style=color:#66d9ef>new</span> HMACSHA512Algorithm())
            .WithSecret(jwtConfig.Secret);
    }
}
</code></pre></div><p>Creating the token itself is also pretty much copy-pasted from their
<a href=https://github.com/jwt-dotnet/jwt#register-authentication-handler-to-validate-jwt>docs</a>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string</span> Create(<span style=color:#66d9ef>string</span> username)
{
    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>_</span>jwtBuilder
        .AddClaim(<span style=color:#e6db74>&#34;exp&#34;</span>, DateTimeOffset.UtcNow.AddHours(<span style=color:#ae81ff>1</span>).ToUnixTimeSeconds())
        .AddClaim(<span style=color:#e6db74>&#34;username&#34;</span>, username)
        .Encode();
}
</code></pre></div><p>I only use the expiration date and username for claims.</p>
<p>Lastly, verification.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>bool</span> Verify(<span style=color:#66d9ef>string</span> token)
{
    <span style=color:#66d9ef>try</span>
    {
        <span style=color:#66d9ef>var</span> json = <span style=color:#ae81ff>_</span>jwtBuilder
            .MustVerifySignature()
            .Decode(token);

        <span style=color:#66d9ef>return</span> json <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>;
    }
    <span style=color:#66d9ef>catch</span> (Exception)
    {
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
    }
}
</code></pre></div><p>I only need a true or false return as I don&rsquo;t care why the token was not valid. In case the token is a
valid JWT but it is expired, <code>json</code> will be null. If on the other hand, the signature is invalid,
then an exception will be thrown for whatever reason.</p>
<h2 id=the-secured-attribute>The <code>Secured</code> Attribute<a hidden class=anchor aria-hidden=true href=#the-secured-attribute>#</a></h2>
<p>As I mentioned earlier, all this is glued together by the use of attributes. For this to work,
we need to implement the <code>IAuthorizationFilter</code> interface. This will make it so our code will be
executed to determine whether a request should be authorized or not.</p>
<p>The code for this is also simple but let&rsquo;s go over it step by step</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=color:#a6e22e>[AttributeUsage(AttributeTargets.Class | AttributeTargets.Method)]</span>
<span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Secured</span> : Attribute, IAuthorizationFilter
{
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> OnAuthorization(AuthorizationFilterContext context)
    {
        <span style=color:#66d9ef>var</span> jwtConfig = context.HttpContext.RequestServices.GetService&lt;JwtConfig&gt;();
        <span style=color:#66d9ef>if</span> (jwtConfig == <span style=color:#66d9ef>null</span>) <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> ArgumentNullException();

        <span style=color:#66d9ef>var</span> tokenService = <span style=color:#66d9ef>new</span> TokenService(jwtConfig);
        <span style=color:#66d9ef>var</span> token = context
            .HttpContext
            .Request
            .Headers[<span style=color:#e6db74>&#34;Authorization&#34;</span>]
            .ToString()
            .Replace(<span style=color:#e6db74>&#34;Bearer &#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>);

        <span style=color:#66d9ef>if</span> (!tokenService.Verify(token))
            context.Result = <span style=color:#66d9ef>new</span> JsonResult(<span style=color:#66d9ef>new</span> { message = <span style=color:#e6db74>&#34;Unauthorized&#34;</span> })
                { StatusCode = StatusCodes.Status401Unauthorized };
    }
}
</code></pre></div><p>As I mentioned earlier, I want this to apply to both endpoints and entire controllers, hence
the first line. In order to implement <code>IAuthorizationFilter</code>, we need to define the <code>OnAuthorization</code>
method. We use the <code>IServiceProdiver</code> to retrieve our <code>JwtConfig</code> instance and make sure it is not null.
We then instantiate <code>TokenService</code> and retrieve the token from the request header. Finally, we make sure
to throw an Unauthorized message to the user if the token is invalid, otherwise, the request pipeline
will proceed as expected.</p>
<p>And that&rsquo;s it! We can now add our newly created attribute to whichever controller or endpoint we want
and it will be locked behind a valid JWT requirement.</p>
<h2 id=closing>Closing<a hidden class=anchor aria-hidden=true href=#closing>#</a></h2>
<p>This pretty much concludes the article! As I mentioned earlier, this is a very specific and lacking
implementation, the main point of the article was to showcase how you could use your own attributes
to simplify the process which to me feels simpler (and less verbose) compared to some of my previous
implementations.</p>
<p>This is probably the most boring article I&rsquo;ve written so far but I promise you that the project I am
going to use this for is interesting. It&rsquo;s also a lot harder than anything I&rsquo;ve tried before so don&rsquo;t
expect that the be out anytime soon.</p>
<p>Till next time :)</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://antoniosbarotsis.github.io/Blog/tags/csharp/>Csharp</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://antoniosbarotsis.github.io/Blog/posts/posharp/>
<span class=title>Next Page »</span>
<br>
<span>Veritas</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on twitter" href="https://twitter.com/intent/tweet/?text=Simple%20JWT&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f&hashtags=Csharp"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f&title=Simple%20JWT&summary=Simple%20JWT&source=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f&title=Simple%20JWT"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on whatsapp" href="https://api.whatsapp.com/send?text=Simple%20JWT%20-%20https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Simple JWT on telegram" href="https://telegram.me/share/url?text=Simple%20JWT&url=https%3a%2f%2fantoniosbarotsis.github.io%2fBlog%2fposts%2fsimplejwt%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><script src=https://utteranc.es/client.js repo=AntoniosBarotsis/Blog issue-term=pathname label=Comment theme=github-dark crossorigin=anonymous async></script>
</article>
</main>
</body>
</html>